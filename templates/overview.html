{% extends "base.html" %}
{% block title %}Clutch — Overview{% endblock %}

{% block content %}
<div class="page-header">
    <h1>System Overview</h1>
    <p>Real-time health metrics across all Clutch skills</p>
</div>

<div class="card-grid">
    <a href="/cron" class="card card-link">
        <div class="card-title">Cron Success Rate (24h)</div>
        <div class="card-value">
            {% if cron.rate >= 95 %}
                <span style="color: var(--green)">{{ cron.rate }}%</span>
            {% elif cron.rate >= 80 %}
                <span style="color: var(--yellow)">{{ cron.rate }}%</span>
            {% else %}
                <span style="color: var(--red)">{{ cron.rate }}%</span>
            {% endif %}
        </div>
        <div class="card-subtitle">{{ cron.total }} runs, {{ cron.failed }} failed</div>
    </a>

    <a href="/costs" class="card card-link">
        <div class="card-title">Today's API Cost</div>
        <div class="card-value">${{ "%.4f"|format(cost.cost) }}</div>
        <div class="card-subtitle">
            {% if cost.active_alerts > 0 %}
                <span class="badge badge-red">{{ cost.active_alerts }} alert{{ 's' if cost.active_alerts != 1 }}</span>
            {% else %}
                <span class="badge badge-green">No alerts</span>
            {% endif %}
        </div>
    </a>

    <a href="/content" class="card card-link">
        <div class="card-title">Content Pipeline</div>
        <div class="card-value">{{ content.values()|list|sum if content else 0 }}</div>
        <div class="card-subtitle">
            {% for status, cnt in content.items() %}
                <span class="badge badge-{% if status == 'published' %}green{% elif status == 'drafted' %}blue{% elif status == 'approved' %}purple{% else %}gray{% endif %}">{{ status }}: {{ cnt }}</span>
            {% endfor %}
        </div>
    </a>

    <a href="/kb" class="card card-link">
        <div class="card-title">Knowledge Base</div>
        <div class="card-value">{{ "{:,}".format(kb.chunks) }}</div>
        <div class="card-subtitle">{{ kb.sources }} sources</div>
    </a>

    <a href="/briefings" class="card card-link">
        <div class="card-title">Latest Briefing</div>
        {% if briefing %}
            <div class="card-value">{{ briefing.momentum_weekly|default('—') }}</div>
            <div class="card-subtitle">{{ briefing.theme|default('No theme')|truncate(60) }}</div>
        {% else %}
            <div class="card-value">—</div>
            <div class="card-subtitle">No briefings yet</div>
        {% endif %}
    </a>

    <a href="/jobs" class="card card-link">
        <div class="card-title">High-Match Jobs (7d)</div>
        <div class="card-value">{{ jobs }}</div>
        <div class="card-subtitle">Score &ge; 80</div>
    </a>

    <a href="/youtube" class="card card-link">
        <div class="card-title">YouTube Trending Phrases (7d)</div>
        <div class="card-value">{{ youtube }}</div>
        <div class="card-subtitle">Unique phrases detected</div>
    </a>

    <a href="/twitter" class="card card-link">
        <div class="card-title">Twitter Trends</div>
        <div class="card-value">{{ twitter.trending }}</div>
        <div class="card-subtitle">
            {% if twitter.cross_source > 0 %}
                <span class="badge badge-blue">{{ twitter.cross_source }} cross-source</span>
            {% else %}
                trending themes
            {% endif %}
        </div>
    </a>

    <a href="/projects" class="card card-link">
        <div class="card-title">Active Projects</div>
        <div class="card-value">{{ projects.active }}</div>
        <div class="card-subtitle">
            {% if projects.overdue > 0 %}
                <span class="badge badge-red">{{ projects.overdue }} overdue milestone{{ 's' if projects.overdue != 1 }}</span>
            {% else %}
                <span class="badge badge-green">All on track</span>
            {% endif %}
        </div>
    </a>
</div>
{% endblock %}
