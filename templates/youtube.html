{% extends "base.html" %}
{% block title %}Clutch — YouTube{% endblock %}

{% block content %}
<div class="page-header">
    <h1>YouTube Intelligence</h1>
    <p>{{ channel_total }} channels tracked, {{ video_total }} videos indexed</p>
</div>

<div class="card-grid">
    {% for cat in categories %}
    <div class="card">
        <div class="card-title">{{ cat.category or 'uncategorized' }}</div>
        <div class="card-value">{{ cat.count }}</div>
        <div class="card-subtitle">{{ cat.trending_count }} trending</div>
    </div>
    {% endfor %}
</div>

<h3 style="margin-bottom: 0.75rem;">Trending Phrases</h3>
<div class="table-wrap">
    <table>
        <thead>
            <tr>
                <th>Phrase</th>
                <th>Category</th>
                <th>Occurrences</th>
                <th>Trending</th>
                <th>First Seen</th>
                <th>Channel</th>
            </tr>
        </thead>
        <tbody>
            {% for p in phrases %}
            <tr>
                <td>{{ p.phrase }}</td>
                <td><span class="badge badge-{% if p.category == 'ai' %}purple{% elif p.category == 'homelab' %}blue{% elif p.category == 'energy' %}green{% else %}gray{% endif %}">{{ p.category or '—' }}</span></td>
                <td>{{ p.occurrence_count }}</td>
                <td>{% if p.trending %}<span class="badge badge-green">trending</span>{% endif %}</td>
                <td>{{ p.first_seen_date or p.created_at }}</td>
                <td>{{ p.first_seen_channel or '—' }}</td>
            </tr>
            {% endfor %}
            {% if not phrases %}
            <tr><td colspan="6" class="empty-state"><p>No phrases detected</p></td></tr>
            {% endif %}
        </tbody>
    </table>
</div>

<h3 style="margin-bottom: 0.75rem;">Tracked Channels</h3>
<div class="table-wrap">
    <table>
        <thead>
            <tr>
                <th>Channel</th>
                <th>Category</th>
                <th>Videos Tracked</th>
                <th>Last Scan</th>
                <th>Active</th>
            </tr>
        </thead>
        <tbody>
            {% for c in channels %}
            <tr>
                <td>{{ c.name }}</td>
                <td><span class="badge badge-blue">{{ c.category or '—' }}</span></td>
                <td>{{ c.total_videos_tracked }}</td>
                <td>{{ c.last_scan_date or '—' }}</td>
                <td>{% if c.active %}<span class="badge badge-green">active</span>{% else %}<span class="badge badge-gray">inactive</span>{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<h3 style="margin-bottom: 0.75rem;">Recent Videos</h3>
<div class="table-wrap">
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Channel</th>
                <th>Upload Date</th>
                <th>Views</th>
                <th>Tags</th>
            </tr>
        </thead>
        <tbody>
            {% for v in videos %}
            <tr>
                <td>{% if v.video_url %}<a href="{{ v.video_url }}" target="_blank">{{ v.title|truncate(60) }}</a>{% else %}{{ v.title|truncate(60) }}{% endif %}</td>
                <td>{{ v.channel_name or '—' }}</td>
                <td>{{ v.upload_date or '—' }}</td>
                <td>{{ "{:,}".format(v.view_count) if v.view_count else '—' }}</td>
                <td style="font-size: 0.8rem; color: var(--text-muted)">{{ v.domain_tags or '—' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
